<style>
    .outer-container{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    h1, h2{
        text-align: center;
    }
    p{
        margin: 0;
    }
    form{
        text-align: center;
    }
    .chat-messages{
        display: flex;
        flex-direction: column;
        height: 300px;
        overflow-y: scroll;
        width: 100%;
        border: 1px solid lightgray;
        padding: 10px;
        background-color: white;
    }
    .incoming-message, .outgoing-message{
        margin: 10px 0;
    }
    .incoming-message{
        text-align: left;
    }
    .incoming-message .message{
        display: inline-block;
        padding: 10px;
        background: #ADD8E6;
        background: linear-gradient(180deg, rgba(173, 216, 230, 1) 0%, rgba(128, 187, 207, 1) 100%);
        border: 1px solid lightgray;
        border-radius: 10px 10px 10px 0;
        max-width: 47%;
    }
    .outgoing-message{
        text-align: right;
    }
    .outgoing-message .message{
        display: inline-block;
        padding: 10px;
        background: #90EE90;
        background: linear-gradient(180deg, rgba(144, 238, 144, 1) 0%, rgba(112, 207, 112, 1) 100%);
        border: 1px solid lightgray;
        border-radius: 10px 10px 0 10px;
        max-width: 47%;
    }
    .chat-container{
        display: flex;
        flex-direction: column;
        width: 45%;
    }
    .send-message-container{
        width: 100%;
        background-color: white;
    }
</style>
{% extends 'GuestHomepage.html' %}
<body>
    {% block body %}
    <h1>Chat</h1>
    <div class="outer-container">

        <div class="chat-options-container">
            <div class="open-previous-chat-container">
                <h2>Open Previous Chat</h2>
                <form method="GET" action="{{ url_for('chat_bp.chat_view') }}">
                        {% if previous_chats %}
                            <select name="chat_id">
                            {% for chat in previous_chats %}
                                <option value="{{ chat['CHAT_ID'] }}">{{ chat['CHAT_ID'] }}</option>
                            {% endfor %}
                            </select>
                            <input type="submit" value="Open Chat">
                        {% else %}
                        <select name="chat_id">
                            <option>No chats found</option>
                        </select>
                        <input type="submit" value="Open Chat" disabled>
                        {% endif %}
                </form>
            </div>
    
            <div class="start-new-chat-container">
                <h2>Start New Chat</h2>
                <form>
                    <select>
                        <option>Vendor</option>
                        <option>Admin</option>
                    </select>
                    <div style="display: inline-block;">
                        <input type="text" placeholder="Vendor ID">
                    </div>
                    <input type="text" placeholder="Product ID">
                    <input type="submit" value="Start Chat">
                </form>
            </div>
        </div>

        <div class="chat-container">
            <p>Chat ID: {{ selected_chat.CHAT_ID if selected_chat else "N/A" }}</p>

            {% if message %}
                <p style="color: red;">{{ message }}</p>
            {% endif %}

            <div class="chat-messages">
                {% for message in messages %}
                    {% if message['CID'] %}
                        <div class="outgoing-message">
                            <div class="info"><p>You at {{ message['timestamp'] }}</p></div>
                            <div class="message">
                                <p>{{ message['message'] }}</p>
                                {% if message['images'] %}
                                    <img src="{{ url_for('static', filename='images/' + message['images']) }}" alt="Image" style="max-width: 100px;">
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}

                    {% if message['VID'] %}
                        <div class="incoming-message">
                            <div class="info"><p>Vendor at {{ message['timestamp'] }}</p></div>
                            <div class="message">
                                <p>{{ message['message'] }}</p>
                                {% if message['images'] %}
                                    <img src="{{ url_for('static', filename='images/' + message['images']) }}" alt="Image" style="max-width: 100px;">
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>

            <div class="send-message-container">
                <form>
                    <input type="text" placeholder="Type your message here...">
                    <input type="submit" value="Send">
                </form>
            </div>
        </div>

    </div>
    {% endblock %}
</body>
</html>
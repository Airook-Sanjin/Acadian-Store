<style>
    .outer-container{
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    h1, h2{
        text-align: center;
    }
    p{
        margin: 0;
    }
    form{
        text-align: center;
    }
    .chat-messages{
        display: flex;
        flex-direction: column;
        height: 300px;
        overflow-y: scroll;
        width: 100%;
        border: 1px solid lightgray;
        padding: 10px;
        background-color: white;
    }
    .incoming-message, .outgoing-message{
        margin: 10px 0;
    }
    .incoming-message{
        text-align: left;
    }
    .incoming-message .message{
        display: inline-block;
        padding: 10px;
        background-color: lightblue;
        border-radius: 10px 10px 10px 0;
    }
    .outgoing-message{
        text-align: right;
    }
    .outgoing-message .message{
        display: inline-block;
        padding: 10px;
        background-color: lightgreen;
        border-radius: 10px 10px 0 10px;
    }
    .chat-container{
        display: flex;
        flex-direction: column;
        width: 50%;
    }
    .send-message-container{
        width: 100%;
        background-color: white;
    }
</style>
{% extends 'GuestHomepage.html' %}
<body>
    {% block body %}
    <div class="outer-container">

        <h1>Chat</h1>

        <div class="open-previous-chat-container">
            <h2>Open Previous Chat</h2>
            <form method="GET" action="{{ url_for('chat_bp.chat_view') }}">
                <select name="chat_id">
                    {% if previous_chats %}
                        {% for chat in previous_chats %}
                            <option value="{{ chat['CHAT_ID'] }}">{{ chat['CHAT_ID'] }}</option>
                        {% endfor %}
                    {% else %}
                        <option>No chats found</option>
                    {% endif %}
                </select>
                <input type="submit" value="Open Chat">
            </form>
        </div>

        <div class="chat-container">
            <h2>Chat with {{ selected_chat.vendor_name if selected_chat else "Vendor" }}</h2>
            <p>Chat ID: {{ selected_chat.CHAT_ID if selected_chat else "N/A" }}</p>

            {% if message %}
                <p style="color: red;">{{ message }}</p>
            {% endif %}

            <div class="chat-messages">
                {% for message in messages %}
                    {% if message['CID'] %}
                        <div class="outgoing-message">
                            <div class="info"><p>You at {{ message['timestamp'] }}</p></div>
                            <div class="message">
                                <p>{{ message['message'] }}</p>
                                {% if message['images'] %}
                                    <img src="{{ url_for('static', filename='images/' + message['images']) }}" alt="Image" style="max-width: 100px;">
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}

                    {% if message['VID'] %}
                        <div class="incoming-message">
                            <div class="info"><p>Vendor at {{ message['timestamp'] }}</p></div>
                            <div class="message">
                                <p>{{ message['message'] }}</p>
                                {% if message['images'] %}
                                    <img src="{{ url_for('static', filename='images/' + message['images']) }}" alt="Image" style="max-width: 100px;">
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>

            <div class="send-message-container">
                <form>
                    <input type="text" placeholder="Type your message here...">
                    <input type="submit" value="Send">
                </form>
            </div>
        </div>
    </div>
    {% endblock %}
</body>
</html>